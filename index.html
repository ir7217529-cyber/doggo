<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Golden Care</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      --bg1:#0b0b10;
      --bg2:#12121a;
      --card: rgba(31,31,38,0.92);
      --stroke: rgba(255,255,255,0.08);
      --text:#ffffff;
      --muted:#a7a7b3;
      --radius:16px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: radial-gradient(900px 500px at 20% 10%, #1b1b28 0%, transparent 60%),
                  radial-gradient(900px 500px at 80% 20%, #23233a 0%, transparent 60%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .wrap{
      max-width:720px;
      margin:0 auto;
      padding:14px 14px calc(14px + env(safe-area-inset-bottom));
      position:relative;
      z-index:2;
    }

    /* –§–æ–Ω–æ–≤–∞—è –∞–Ω–∏–º–∞—Ü–∏—è: –ø–µ—Å + –ª–∞–ø–∫–∏ */
    .bg{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:1;
      opacity:0.55;
    }
    .dog{
      position:absolute;
      left: 12px;
      bottom: 18px;
      font-size: 64px;
      filter: drop-shadow(0 10px 25px rgba(0,0,0,0.45));
      animation: dog-bounce 2.4s ease-in-out infinite;
      transform-origin: 50% 100%;
    }
    .paw{
      position:absolute;
      right:-40px;
      top: 20%;
      font-size: 22px;
      opacity:0.18;
      animation: paw-drift 9s linear infinite;
    }
    .paw:nth-child(2){ top: 35%; animation-duration: 11s; font-size: 20px; opacity:0.14; }
    .paw:nth-child(3){ top: 55%; animation-duration: 13s; font-size: 24px; opacity:0.16; }
    .paw:nth-child(4){ top: 70%; animation-duration: 10s; font-size: 21px; opacity:0.12; }

    @keyframes dog-bounce{
      0%,100% { transform: translateY(0) rotate(-2deg); }
      50%     { transform: translateY(-10px) rotate(2deg); }
    }
    @keyframes paw-drift{
      0%   { transform: translateX(0) rotate(-10deg); }
      100% { transform: translateX(-120vw) rotate(10deg); }
    }

    header{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-top:8px;
    }
    h1{
      font-size:22px;
      margin:0;
      line-height:1.1;
    }
    .sub{
      margin-top:4px;
      color:var(--muted);
      font-size:12.5px;
    }

    .chip{
      padding:8px 10px;
      border:1px solid var(--stroke);
      border-radius:999px;
      background: rgba(0,0,0,0.18);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    .card{
      margin-top:12px;
      background: var(--card);
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      padding: 12px;
      backdrop-filter: blur(10px);
    }

    .stats{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 420px){
      .stats{ grid-template-columns: 1fr; }
    }

    .stat{
      border: 1px solid var(--stroke);
      border-radius: 14px;
      padding: 10px;
      background: rgba(0,0,0,0.10);
    }
    .stat-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
      font-size:12.5px;
    }
    .stat-name{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
    }
    .stat-val{
      font-variant-numeric: tabular-nums;
      color: #fff;
      opacity:0.9;
    }
    .bar{
      width:100%;
      height:10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.10);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.08);
    }
    .fill{
      height:100%;
      width:50%;
      border-radius: 999px;
      background: rgba(255,255,255,0.85);
      transform-origin:left center;
      transition: width 220ms ease;
    }

    /* –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—å—à–µ */
    .actions{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }
    @media (max-width: 360px){
      .actions{ grid-template-columns: 1fr; }
    }
    button.action{
      width:100%;
      border: 1px solid var(--stroke);
      border-radius: 16px;
      padding: 12px 12px;
      background: rgba(0,0,0,0.18);
      color: var(--text);
      text-align:left;
      cursor:pointer;
      min-height: 58px;
      transition: transform 120ms ease, background 120ms ease;
    }
    button.action:active{
      transform: scale(0.98);
    }
    .a-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .a-title{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:14.5px;
      font-weight:700;
    }
    .a-emoji{
      font-size:22px; /* –º–µ–Ω—å—à–µ –∏–∫–æ–Ω–∫–∏ */
      line-height:1;
    }
    .a-hint{
      margin-top:6px;
      color:var(--muted);
      font-size:11.5px;
    }

    .row{
      display:flex;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .btn-mini{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,0.18);
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      cursor:pointer;
    }
    .btn-mini:active{ transform: scale(0.98); }

    .history{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-top:10px;
      max-height: 260px;
      overflow:auto;
      padding-right:2px;
    }
    .log{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,0.10);
      border-radius: 12px;
      padding: 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .log-left{
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .log-emoji{
      font-size:20px;
      line-height:1;
      margin-top:1px;
    }
    .log-text{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .log-title{
      font-size:13.5px;
      font-weight:700;
    }
    .log-time{
      font-size:11.5px;
      color:var(--muted);
    }

    .toast{
      position:fixed;
      left:50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.65);
      border: 1px solid rgba(255,255,255,0.12);
      color:#fff;
      padding:10px 12px;
      border-radius:999px;
      font-size:12.5px;
      opacity:0;
      pointer-events:none;
      transition: opacity 180ms ease, transform 180ms ease;
      z-index:3;
      backdrop-filter: blur(8px);
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(-6px);
    }
  </style>
</head>

<body>
  <div class="bg">
    <div class="dog">üê∂</div>
    <div class="paw">üêæ</div>
    <div class="paw">üêæ</div>
    <div class="paw">üêæ</div>
    <div class="paw">üêæ</div>
  </div>

  <div class="wrap">
    <header>
      <div>
        <h1>Golden Care</h1>
        <div class="sub" id="sub">–ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–æ—Ñ–∏–ª—å‚Ä¶</div>
      </div>
      <div class="chip" id="chip">v1.0 ‚Ä¢ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</div>
    </header>

    <div class="card">
      <div class="stats">
        <div class="stat">
          <div class="stat-top">
            <div class="stat-name">üçó –°—ã—Ç–æ—Å—Ç—å</div>
            <div class="stat-val" id="v_hunger">‚Äî</div>
          </div>
          <div class="bar"><div class="fill" id="b_hunger"></div></div>
        </div>

        <div class="stat">
          <div class="stat-top">
            <div class="stat-name">üòä –†–∞–¥–æ—Å—Ç—å</div>
            <div class="stat-val" id="v_happy">‚Äî</div>
          </div>
          <div class="bar"><div class="fill" id="b_happy"></div></div>
        </div>

        <div class="stat">
          <div class="stat-top">
            <div class="stat-name">üßº –ß–∏—Å—Ç–æ—Ç–∞</div>
            <div class="stat-val" id="v_clean">‚Äî</div>
          </div>
          <div class="bar"><div class="fill" id="b_clean"></div></div>
        </div>

        <div class="stat">
          <div class="stat-top">
            <div class="stat-name">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
            <div class="stat-val" id="v_energy">‚Äî</div>
          </div>
          <div class="bar"><div class="fill" id="b_energy"></div></div>
        </div>
      </div>

      <div class="actions">
        <button class="action" onclick="doAction('feed')">
          <div class="a-top">
            <div class="a-title"><span class="a-emoji">üçó</span> –ü–æ–∫–æ—Ä–º–∏—Ç—å</div>
            <div class="a-emoji">‚ûï</div>
          </div>
          <div class="a-hint">–°—ã—Ç–æ—Å—Ç—å +25 ‚Ä¢ –†–∞–¥–æ—Å—Ç—å +6</div>
        </button>

        <button class="action" onclick="doAction('walk')">
          <div class="a-top">
            <div class="a-title"><span class="a-emoji">ü¶Æ</span> –ü–æ–≥—É–ª—è—Ç—å</div>
            <div class="a-emoji">‚ûï</div>
          </div>
          <div class="a-hint">–†–∞–¥–æ—Å—Ç—å +18 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è ‚àí10</div>
        </button>

        <button class="action" onclick="doAction('groom')">
          <div class="a-top">
            <div class="a-title"><span class="a-emoji">üßº</span> –í—ã—á–µ—Å–∞—Ç—å</div>
            <div class="a-emoji">‚ûï</div>
          </div>
          <div class="a-hint">–ß–∏—Å—Ç–æ—Ç–∞ +25 ‚Ä¢ –†–∞–¥–æ—Å—Ç—å +4</div>
        </button>

        <button class="action" onclick="doAction('train')">
          <div class="a-top">
            <div class="a-title"><span class="a-emoji">üéæ</span> –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</div>
            <div class="a-emoji">‚ûï</div>
          </div>
          <div class="a-hint">–†–∞–¥–æ—Å—Ç—å +10 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è ‚àí18</div>
        </button>

        <button class="action" onclick="doAction('rest')">
          <div class="a-top">
            <div class="a-title"><span class="a-emoji">üò¥</span> –û—Ç–¥–æ—Ö–Ω—É—Ç—å</div>
            <div class="a-emoji">‚ûï</div>
          </div>
          <div class="a-hint">–≠–Ω–µ—Ä–≥–∏—è +28</div>
        </button>

        <button class="action" onclick="doAction('treat')">
          <div class="a-top">
            <div class="a-title"><span class="a-emoji">ü¶¥</span> –õ–∞–∫–æ–º—Å—Ç–≤–æ</div>
            <div class="a-emoji">‚ûï</div>
          </div>
          <div class="a-hint">–†–∞–¥–æ—Å—Ç—å +16 ‚Ä¢ –°—ã—Ç–æ—Å—Ç—å +8</div>
        </button>
      </div>

      <div class="row">
        <button class="btn-mini" onclick="renameDog()">‚úèÔ∏è –ò–º—è</button>
        <button class="btn-mini" onclick="resetAll()">üóë –°–±—Ä–æ—Å</button>
        <button class="btn-mini" onclick="share()">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
        <div style="font-weight:800;">–ò—Å—Ç–æ—Ä–∏—è</div>
        <div style="color:var(--muted);font-size:12px;" id="saveMode">‚Äî</div>
      </div>
      <div class="history" id="history"></div>
    </div>
  </div>

  <div class="toast" id="toast">OK</div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.ready();

    // ---------- Helpers ----------
    const clamp = (n, a=0, b=100) => Math.max(a, Math.min(b, n));
    const now = () => Date.now();

    function fmtTime(ts){
      try{
        const d = new Date(ts);
        return d.toLocaleString(undefined, { hour: '2-digit', minute: '2-digit', day: '2-digit', month: '2-digit' });
      }catch{
        return '';
      }
    }

    const el = (id) => document.getElementById(id);

    function toast(msg){
      const t = el('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(()=>t.classList.remove('show'), 1100);
    }

    // ---------- Storage (Telegram CloudStorage -> fallback localStorage) ----------
    const KEY = 'golden_care_state_v1';
    const canCloud = !!(tg && tg.CloudStorage && typeof tg.CloudStorage.getItem === 'function');

    function setSaveModeText(){
      el('saveMode').textContent = canCloud ? '–°–æ—Ö—Ä–∞–Ω—è—é –≤ Telegram' : '–°–æ—Ö—Ä–∞–Ω—è—é –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ';
      el('chip').textContent = canCloud ? 'v1.0 ‚Ä¢ Telegram save' : 'v1.0 ‚Ä¢ device save';
    }

    function loadStateLocal(){
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : null;
    }
    function saveStateLocal(state){
      localStorage.setItem(KEY, JSON.stringify(state));
    }

    function loadStateCloud(){
      return new Promise((resolve) => {
        tg.CloudStorage.getItem(KEY, (err, value) => {
          if (err || !value) return resolve(null);
          try{ resolve(JSON.parse(value)); } catch { resolve(null); }
        });
      });
    }
    function saveStateCloud(state){
      return new Promise((resolve) => {
        tg.CloudStorage.setItem(KEY, JSON.stringify(state), () => resolve(true));
      });
    }

    // ---------- Game state ----------
    const DEFAULT = {
      dogName: "–ì–æ–ª–¥–µ–Ω",
      stats: { hunger: 78, happy: 70, clean: 65, energy: 72 },
      history: [],
      lastTick: now()
    };

    let state = structuredClone(DEFAULT);

    function applyDecay(){
      const t = now();
      const dtMin = Math.max(0, (t - (state.lastTick || t)) / 60000); // minutes
      state.lastTick = t;

      // –ü–∞–¥–µ–Ω–∏–µ –≤ –º–∏–Ω—É—Ç—É (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å)
      state.stats.hunger = clamp(state.stats.hunger - dtMin * 0.9);
      state.stats.happy  = clamp(state.stats.happy  - dtMin * 0.45);
      state.stats.clean  = clamp(state.stats.clean  - dtMin * 0.35);
      state.stats.energy = clamp(state.stats.energy - dtMin * 0.70);
    }

    function addLog(emoji, title){
      state.history.unshift({ emoji, title, ts: now() });
      state.history = state.history.slice(0, 50);
    }

    const ACTIONS = {
      feed:  { emoji:"üçó", title:"–ü–æ–∫–æ—Ä–º–∏–ª",  delta:{ hunger:+25, happy:+6,  clean:0,   energy:0 } },
      walk:  { emoji:"ü¶Æ", title:"–ü–æ–≥—É–ª—è–ª",   delta:{ hunger:-6,  happy:+18, clean:-3,  energy:-10 } },
      groom: { emoji:"üßº", title:"–í—ã—á–µ—Å–∞–ª",   delta:{ hunger:0,   happy:+4,  clean:+25, energy:-3 } },
      train: { emoji:"üéæ", title:"–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞",delta:{ hunger:-8,  happy:+10, clean:-2,  energy:-18 } },
      rest:  { emoji:"üò¥", title:"–û—Ç–¥–æ—Ö–Ω—É–ª",  delta:{ hunger:-2,  happy:+2,  clean:0,   energy:+28 } },
      treat: { emoji:"ü¶¥", title:"–õ–∞–∫–æ–º—Å—Ç–≤–æ", delta:{ hunger:+8,  happy:+16, clean:0,   energy:0 } },
    };

    async function persist(){
      if (canCloud) await saveStateCloud(state);
      else saveStateLocal(state);
    }

    function render(){
      const s = state.stats;

      const setBar = (name, val) => {
        el('v_' + name).textContent = Math.round(val) + "%";
        el('b_' + name).style.width = clamp(val) + "%";
      };

      setBar('hunger', s.hunger);
      setBar('happy', s.happy);
      setBar('clean', s.clean);
      setBar('energy', s.energy);

      const who = tg?.initDataUnsafe?.user;
      const uname = who?.first_name ? `${who.first_name}${who.username ? " @" + who.username : ""}` : "–≤ Telegram";
      el('sub').textContent = `–ü–∏—Ç–æ–º–µ—Ü: ${state.dogName} ‚Ä¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${uname}`;

      const list = el('history');
      list.innerHTML = "";
      if (!state.history.length){
        list.innerHTML = `<div style="color:var(--muted);font-size:13px;padding:6px 2px;">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ù–∞–∂–º–∏ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É üôÇ</div>`;
        return;
      }
      state.history.forEach(item => {
        const row = document.createElement('div');
        row.className = 'log';
        row.innerHTML = `
          <div class="log-left">
            <div class="log-emoji">${item.emoji}</div>
            <div class="log-text">
              <div class="log-title">${item.title}</div>
              <div class="log-time">${fmtTime(item.ts)}</div>
            </div>
          </div>
        `;
        list.appendChild(row);
      });
    }

    // ---------- Actions ----------
    window.doAction = async function(key){
      applyDecay();

      const a = ACTIONS[key];
      if (!a) return;

      // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      state.stats.hunger = clamp(state.stats.hunger + (a.delta.hunger || 0));
      state.stats.happy  = clamp(state.stats.happy  + (a.delta.happy  || 0));
      state.stats.clean  = clamp(state.stats.clean  + (a.delta.clean  || 0));
      state.stats.energy = clamp(state.stats.energy + (a.delta.energy || 0));

      addLog(a.emoji, a.title);

      // Telegram –ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏
      tg?.HapticFeedback?.impactOccurred?.("light");

      // –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –ø—Ä—è–º –ø–ª–æ—Ö–æ
      if (state.stats.hunger < 15) toast("–û–Ω –≥–æ–ª–æ–¥–Ω—ã–π üò≠");
      else if (state.stats.energy < 15) toast("–û–Ω —É—Å—Ç–∞–ª üò¥");
      else toast(`${a.emoji} ${a.title}!`);

      await persist();
      render();
    }

    window.renameDog = async function(){
      const name = prompt("–ö–∞–∫ –Ω–∞–∑–æ–≤—ë–º –ø—ë—Å–µ–ª—è? üòÑ", state.dogName);
      if (!name) return;
      state.dogName = name.slice(0, 18);
      addLog("‚úèÔ∏è", `–ò–º—è: ${state.dogName}`);
      await persist();
      render();
      toast("–ò–º—è –æ–±–Ω–æ–≤–∏–ª ‚úÖ");
    }

    window.resetAll = async function(){
      if (!confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë? –ò—Å—Ç–æ—Ä–∏—è –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –æ–±–Ω—É–ª—è—Ç—Å—è.")) return;
      state = structuredClone(DEFAULT);
      await persist();
      render();
      toast("–°–±—Ä–æ—Å–∏–ª üóë");
    }

    window.share = function(){
      const s = state.stats;
      const msg = `üê∂ ${state.dogName}\nüçó –°—ã—Ç–æ—Å—Ç—å: ${Math.round(s.hunger)}%\nüòä –†–∞–¥–æ—Å—Ç—å: ${Math.round(s.happy)}%\nüßº –ß–∏—Å—Ç–æ—Ç–∞: ${Math.round(s.clean)}%\n‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${Math.round(s.energy)}%`;
      tg?.showPopup?.({ title: "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è", message: msg, buttons: [{type:"ok"}] }) || alert(msg);
    }

    // ---------- Boot ----------
    async function boot(){
      setSaveModeText();

      let loaded = null;
      if (canCloud) loaded = await loadStateCloud();
      if (!loaded) loaded = loadStateLocal();

      state = loaded ? loaded : structuredClone(DEFAULT);

      // –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–µ ‚Äî –ø—Ä–∏–º–µ–Ω–∏–º —Å–ø–∞–¥
      applyDecay();
      await persist();
      render();

      // —Ç–∏–∫–∞–µ–º —Ä–∞–∑ –≤ 10 —Å–µ–∫: –≤–∏–∑—É–∞–ª—å–Ω–æ –∏ –ø–æ –∏–≥—Ä–µ
      setInterval(async () => {
        applyDecay();
        await persist();
        render();
      }, 10000);
    }

    boot();
  </script>
</body>
</html>


